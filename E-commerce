
print("ğŸš€ INICIANDO ANÃLISE DE DADOS DE E-COMMERCE")
print("=" * 60)


import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from datetime import datetime, timedelta
import random

plt.style.use('default')
sns.set_palette("husl")
%matplotlib inline

print("âœ… Bibliotecas carregadas com sucesso!")
print("ğŸ“¦ VersÃµes:")
print(f"   pandas: {pd.__version__}")
print(f"   numpy: {np.__version__}")
print(f"   matplotlib: {plt.matplotlib.__version__}")

# =============================================================================
# ğŸ“ 1. GERAR DADOS DE EXEMPLO
# =============================================================================

print("\n" + "=" * 60)
print("ğŸ”„ GERANDO DADOS DE EXEMPLO...")
print("=" * 60)

def generate_ecommerce_data(num_records=5000):
    """Gera dados realisticos de e-commerce"""

    products = [
        'Smartphone Galaxy', 'iPhone Pro', 'Notebook Dell', 'Macbook Air',
        'Tablet Samsung', 'iPad Pro', 'Fone Bluetooth', 'Smartwatch Apple',
        'Camera DSLR', 'Console PlayStation', 'Xbox Series', 'TV LED 55"',
        'Monitor Gaming', 'Impressora Laser', 'Mouse Gamer', 'Teclado Mecanico'
    ]

    categories = ['Eletronicos', 'Informatica', 'Audio', 'Games', 'TV & Video', 'Acessorios']
    regions = ['SP', 'RJ', 'MG', 'RS', 'PR', 'SC', 'BA', 'DF']
    payment_methods = ['Credit Card', 'Debit Card', 'Boleto', 'PIX']

    data = []
    for i in range(num_records):
        price = round(random.uniform(50, 2500), 2)
        quantity = random.randint(1, 3)

        # Gerar data aleatoria (Ãºltimos 12 meses)
        random_date = datetime(2023, 1, 1) + timedelta(days=random.randint(0, 365))

        record = {
            'order_id': f'ORD{10000 + i}',
            'customer_id': f'CUST{5000 + random.randint(1, 1000)}',
            'product': random.choice(products),
            'category': random.choice(categories),
            'price': price,
            'quantity': quantity,
            'revenue': price * quantity,
            'purchase_date': random_date,
            'customer_region': random.choice(regions),
            'payment_method': random.choice(payment_methods),
            'customer_age': random.randint(18, 70),
            'product_rating': round(random.uniform(3.0, 5.0), 1)
        }
        data.append(record)

    return pd.DataFrame(data)

# Gerar dados
df = generate_ecommerce_data(5000)
print(f"âœ… Dados gerados: {len(df)} registros")
print("ğŸ“‹ Primeiras 5 linhas:")
print(df.head())

# =============================================================================
# ğŸ§¹ 2. LIMPEZA E PROCESSAMENTO DE DADOS
# =============================================================================

print("\n" + "=" * 60)
print("ğŸ§¹ PROCESSANDO E LIMPANDO DADOS...")
print("=" * 60)

# Remover duplicatas
initial_count = len(df)
df = df.drop_duplicates()
print(f"â– Removidos {initial_count - len(df)} registros duplicados")

# Tratar valores missing (simular alguns missing)
df['product_rating'] = df['product_rating'].fillna(df['product_rating'].median())
df['customer_region'] = df['customer_region'].fillna('Unknown')

# Remover outliers de preÃ§o
Q1 = df['price'].quantile(0.05)
Q3 = df['price'].quantile(0.95)
IQR = Q3 - Q1
lower_bound = Q1 - 1.5 * IQR
upper_bound = Q3 + 1.5 * IQR

before = len(df)
df = df[(df['price'] >= lower_bound) & (df['price'] <= upper_bound)]
print(f"ğŸ“‰ Removidos {before - len(df)} outliers de preÃ§o")

# Criar novas features
df['purchase_month'] = df['purchase_date'].dt.to_period('M')
df['purchase_day'] = df['purchase_date'].dt.day_name()
df['purchase_hour'] = df['purchase_date'].dt.hour

# CategorizaÃ§Ã£o de preÃ§os
df['price_category'] = pd.cut(df['price'],
                             bins=[0, 100, 500, 1000, 2000, 5000],
                             labels=['Muito Baixo', 'Baixo', 'Medio', 'Alto', 'Muito Alto'])

print(f"âœ… Dados processados: {len(df)} registros vÃ¡lidos")
print(f"ğŸ“… PerÃ­odo: {df['purchase_date'].min().date()} a {df['purchase_date'].max().date()}")

# =============================================================================
# ğŸ“ˆ 3. ANÃLISE EXPLORATÃ“RIA
# =============================================================================

print("\n" + "=" * 60)
print("ğŸ“ˆ ANÃLISE EXPLORATÃ“RIA")
print("=" * 60)

# MÃ©tricas bÃ¡sicas
total_revenue = df['revenue'].sum()
avg_order_value = df['revenue'].mean()
total_customers = df['customer_id'].nunique()
total_orders = df['order_id'].nunique()

print(f"ğŸ’° Receita Total: R$ {total_revenue:,.2f}")
print(f"ğŸ« Ticket MÃ©dio: R$ {avg_order_value:.2f}")
print(f"ğŸ‘¥ Clientes Ãšnicos: {total_customers}")
print(f"ğŸ“¦ Pedidos Totais: {total_orders}")

# VisualizaÃ§Ã£o 1: Receita por Categoria
plt.figure(figsize=(12, 6))
category_revenue = df.groupby('category')['revenue'].sum().sort_values(ascending=False)
category_revenue.plot(kind='bar', color='skyblue')
plt.title('ğŸ“Š Receita por Categoria de Produto', fontsize=16, fontweight='bold')
plt.xlabel('Categoria')
plt.ylabel('Receita (R$)')
plt.xticks(rotation=45)
plt.grid(axis='y', alpha=0.3)
plt.tight_layout()
plt.show()

# VisualizaÃ§Ã£o 2: DistribuiÃ§Ã£o de PreÃ§os
plt.figure(figsize=(10, 6))
plt.hist(df['price'], bins=30, alpha=0.7, color='lightgreen', edgecolor='black')
plt.title('ğŸ“¦ DistribuiÃ§Ã£o de PreÃ§os dos Produtos', fontsize=16, fontweight='bold')
plt.xlabel('PreÃ§o (R$)')
plt.ylabel('FrequÃªncia')
plt.grid(alpha=0.3)
plt.axvline(df['price'].mean(), color='red', linestyle='--', label=f'MÃ©dia: R$ {df["price"].mean():.2f}')
plt.legend()
plt.show()

# VisualizaÃ§Ã£o 3: Receita Mensal
plt.figure(figsize=(12, 6))
monthly_revenue = df.groupby('purchase_month')['revenue'].sum()
monthly_revenue.plot(kind='line', marker='o', linewidth=2, markersize=8, color='orange')
plt.title('ğŸ“ˆ TendÃªncia de Receita Mensal', fontsize=16, fontweight='bold')
plt.xlabel('MÃªs')
plt.ylabel('Receita (R$)')
plt.grid(alpha=0.3)
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()

# =============================================================================
# ğŸ§® 4. CÃLCULO DE MÃ‰TRICAS AVANÃ‡ADAS
# =============================================================================

print("\n" + "=" * 60)
print("ğŸ§® MÃ‰TRICAS DE PERFORMANCE")
print("=" * 60)

# Calcular mÃ©tricas de negÃ³cio
def calculate_business_metrics(df):
    metrics = {}

    # MÃ©tricas bÃ¡sicas
    metrics['total_revenue'] = df['revenue'].sum()
    metrics['avg_order_value'] = df['revenue'].mean()
    metrics['total_customers'] = df['customer_id'].nunique()
    metrics['total_orders'] = df['order_id'].nunique()

    # CAC (estimado)
    total_marketing_spend = 120000  # Valor estimado
    metrics['cac'] = total_marketing_spend / metrics['total_customers']

    # LTV (estimado)
    avg_revenue_per_customer = df.groupby('customer_id')['revenue'].sum().mean()
    avg_customer_lifespan = 18  # meses
    metrics['ltv'] = avg_revenue_per_customer * avg_customer_lifespan

    # Taxa de conversÃ£o (estimada)
    total_visitors = 25000  # estimado
    metrics['conversion_rate'] = (metrics['total_orders'] / total_visitors) * 100

    # Repeat customer rate
    customer_order_count = df['customer_id'].value_counts()
    repeat_customers = (customer_order_count > 1).sum()
    metrics['repeat_rate'] = (repeat_customers / metrics['total_customers']) * 100

    return metrics

# Calcular e mostrar mÃ©tricas
metrics = calculate_business_metrics(df)

print("ğŸ“Š MÃ‰TRICAS DE NEGÃ“CIO:")
print("-" * 40)
print(f"ğŸ’° Receita Total: R$ {metrics['total_revenue']:,.2f}")
print(f"ğŸ« Ticket MÃ©dio: R$ {metrics['avg_order_value']:.2f}")
print(f"ğŸ‘¥ Clientes Ãšnicos: {metrics['total_customers']}")
print(f"ğŸ“¦ Pedidos Totais: {metrics['total_orders']}")
print(f"ğŸ’µ CAC: R$ {metrics['cac']:.2f}")
print(f"ğŸ’ LTV: R$ {metrics['ltv']:.2f}")
print(f"ğŸ”„ Taxa de ConversÃ£o: {metrics['conversion_rate']:.2f}%")
print(f"ğŸ” Repeat Rate: {metrics['repeat_rate']:.2f}%")
print(f"ğŸ“ˆ LTV/CAC Ratio: {metrics['ltv']/metrics['cac']:.2f}")

# =============================================================================
# ğŸ’¡ 5. IDENTIFICAÃ‡ÃƒO DE OPORTUNIDADES
# =============================================================================

print("\n" + "=" * 60)
print("ğŸ’¡ OPORTUNIDADES DE NEGÃ“CIO")
print("=" * 60)

# AnÃ¡lise de oportunidades
def identify_opportunities(df):
    opportunities = []

    # 1. AnÃ¡lise de categorias
    category_analysis = df.groupby('category').agg({
        'revenue': 'sum',
        'order_id': 'nunique',
        'quantity': 'sum'
    }).sort_values('revenue', ascending=False)

    # Categorias com maior potencial
    low_volume_high_margin = category_analysis[category_analysis['order_id'] < category_analysis['order_id'].median()]
    if not low_volume_high_margin.empty:
        opportunities.append({
            'tipo': 'ExpansÃ£o de Categoria',
            'descricao': 'Categorias com alta margem e baixo volume identificadas',
            'impacto': '5-7% aumento na receita',
            'categorias': low_volume_high_margin.index.tolist()[:3]
        })

    # 2. AnÃ¡lise sazonal
    monthly_revenue = df.groupby('purchase_month')['revenue'].sum()
    revenue_std = monthly_revenue.std()
    if revenue_std > monthly_revenue.mean() * 0.3:
        opportunities.append({
            'tipo': 'OtimizaÃ§Ã£o Sazonal',
            'descricao': 'Fortes variaÃ§Ãµes sazonais detectadas',
            'impacto': '3-5% aumento na receita',
            'meses_pico': monthly_revenue.nlargest(3).index.tolist()
        })

    # 3. Clientes inativos
    last_purchase = df.groupby('customer_id')['purchase_date'].max()
    cutoff_date = df['purchase_date'].max() - timedelta(days=90)
    inactive_customers = last_purchase[last_purchase < cutoff_date]

    if len(inactive_customers) > 0:
        opportunities.append({
            'tipo': 'Campanha de RetenÃ§Ã£o',
            'descricao': f'{len(inactive_customers)} clientes inativos identificados',
            'impacto': '2-4% aumento na receita',
            'acao': 'Programa de fidelidade e retenÃ§Ã£o'
        })

    return opportunities

# Identificar e mostrar oportunidades
opportunities = identify_opportunities(df)

print("ğŸ¯ OPORTUNIDADES IDENTIFICADAS:")
print("-" * 50)
for i, opp in enumerate(opportunities, 1):
    print(f"{i}. {opp['tipo']}:")
    print(f"   ğŸ“ {opp['descricao']}")
    print(f"   ğŸ’° Impacto: {opp['impacto']}")
    if 'categorias' in opp:
        print(f"   ğŸ·ï¸  Categorias: {', '.join(opp['categorias'])}")
    if 'acao' in opp:
        print(f"   ğŸ¯ AÃ§Ã£o: {opp['acao']}")
    print()

# =============================================================================
# ğŸ“Š 6. VISUALIZAÃ‡Ã•ES AVANÃ‡ADAS
# =============================================================================

print("\n" + "=" * 60)
print("ğŸ“Š VISUALIZAÃ‡Ã•ES AVANÃ‡ADAS")
print("=" * 60)

# Criar subplots
fig, axes = plt.subplots(2, 2, figsize=(15, 12))
fig.suptitle('ğŸ“ˆ DASHBOARD DE ANÃLISE - E-COMMERCE', fontsize=20, fontweight='bold')

# GrÃ¡fico 1: Receita por RegiÃ£o
region_revenue = df.groupby('customer_region')['revenue'].sum().sort_values(ascending=False)
axes[0, 0].bar(region_revenue.index, region_revenue.values, color='lightblue')
axes[0, 0].set_title('ğŸ“ Receita por RegiÃ£o', fontweight='bold')
axes[0, 0].set_ylabel('Receita (R$)')
axes[0, 0].tick_params(axis='x', rotation=45)

# GrÃ¡fico 2: MÃ©todo de Pagamento
payment_counts = df['payment_method'].value_counts()
axes[0, 1].pie(payment_counts.values, labels=payment_counts.index, autopct='%1.1f%%', colors=sns.color_palette("pastel"))
axes[0, 1].set_title('ğŸ’³ DistribuiÃ§Ã£o de Pagamentos', fontweight='bold')

# GrÃ¡fico 3: Rating dos Produtos
axes[1, 0].hist(df['product_rating'], bins=10, alpha=0.7, color='lightgreen', edgecolor='black')
axes[1, 0].set_title('â­ AvaliaÃ§Ã£o dos Produtos', fontweight='bold')
axes[1, 0].set_xlabel('AvaliaÃ§Ã£o (1-5)')
axes[1, 0].set_ylabel('FrequÃªncia')
axes[1, 0].axvline(df['product_rating'].mean(), color='red', linestyle='--', label=f'MÃ©dia: {df["product_rating"].mean():.2f}')
axes[1, 0].legend()

# GrÃ¡fico 4: Receita por Dia da Semana
day_order = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']
day_revenue = df.groupby('purchase_day')['revenue'].sum().reindex(day_order)
axes[1, 1].plot(day_order, day_revenue.values, marker='o', linewidth=2, markersize=6, color='purple')
axes[1, 1].set_title('ğŸ“… Receita por Dia da Semana', fontweight='bold')
axes[1, 1].set_ylabel('Receita (R$)')
axes[1, 1].tick_params(axis='x', rotation=45)

plt.tight_layout()
plt.show()

# =============================================================================
# ğŸ¯ 7. RELATÃ“RIO FINAL E RECOMENDAÃ‡Ã•ES
# =============================================================================

print("\n" + "=" * 60)
print("ğŸ¯ RELATÃ“RIO FINAL E RECOMENDAÃ‡Ã•ES")
print("=" * 60)

# Calcular potencial de aumento
potential_increase = sum([5, 4, 3][:len(opportunities)])  # 5% + 4% + 3%
potential_revenue = metrics['total_revenue'] * (potential_increase / 100)

print(f"ğŸ“ˆ RESUMO DA ANÃLISE:")
print("-" * 40)
print(f"â€¢ PerÃ­odo analisado: 12 meses")
print(f"â€¢ Total de registros: {len(df):,}")
print(f"â€¢ Receita total: R$ {metrics['total_revenue']:,.2f}")
print(f"â€¢ Clientes Ãºnicos: {metrics['total_customers']}")
print(f"â€¢ Ticket mÃ©dio: R$ {metrics['avg_order_value']:.2f}")

print(f"\nğŸ¯ OPORTUNIDADES IDENTIFICADAS ({len(opportunities)}):")
print("-" * 40)
for i, opp in enumerate(opportunities, 1):
    print(f"{i}. {opp['tipo']} â†’ {opp['impacto']}")

print(f"\nğŸ’° IMPACTO POTENCIAL:")
print("-" * 40)
print(f"â€¢ Aumento total potencial: {potential_increase}%")
print(f"â€¢ Receita adicional: R$ {potential_revenue:,.2f}")
print(f"â€¢ Nova receita anual: R$ {metrics['total_revenue'] + potential_revenue:,.2f}")

print(f"\nğŸ¯ RECOMENDAÃ‡Ã•ES ESTRATÃ‰GICAS:")
print("-" * 40)
print("1. ğŸ·ï¸  ExpansÃ£o de Categorias: Focar em categorias de alta margem")
print("2. ğŸ“… OtimizaÃ§Ã£o Sazonal: Criar campanhas para perÃ­odos de baixa")
print("3. ğŸ¤ RetenÃ§Ã£o de Clientes: Implementar programa de fidelidade")
print("4. ğŸ“Š Monitoramento ContÃ­nuo: Manter anÃ¡lise mensal dos indicadores")

print("\n" + "=" * 60)
print("âœ… ANÃLISE CONCLUÃDA COM SUCESSO!")
print("=" * 60)
print("ğŸ“Š Projeto desenvolvido por: JoÃ£o Pedro Tavares Pereira Fernandes")
print("ğŸ“§ joaopeedrotavares23@gmail.com")
print("ğŸ’¼ LinkedIn: linkedin.com/in/joÃ£o-pedro-tavares")
print("ğŸ™ GitHub: github.com/bradockdan")
